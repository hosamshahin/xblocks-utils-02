!function(t,e){"use strict";t.xblocks=t.xblocks||{};var o=t.xblocks;o.utils=o.utils||{},o.dom=o.dom||{},o.event=o.event||{};var i=Array.prototype.indexOf,n=Object.prototype.hasOwnProperty;o.utils.debounce=function(e,o,i){o=Number(o||250);var n=null;return function(){var r=i||this,s=arguments;t.clearTimeout(n),n=t.setTimeout(function(){e.apply(r,s)},o)}},o.utils.throttle=function(e,o,i){o=Number(o||250);var n,r;return function(){var s=i||this,c=Date.now(),h=arguments;n&&n+o>c?(t.clearTimeout(r),r=t.setTimeout(function(){n=c,e.apply(s,h)},o)):(n=c,e.apply(s,h))}},o.utils.microtask=function(){var e=0,o=[],i=t.document.createTextNode(""),n=t.MutationObserver||t.JsMutationObserver;return new n(function(){for(;o.length;)o.shift()()}).observe(i,{characterData:!0}),function(t){i.textContent=e++,o.push(t)}}(),o.utils.filterObject=function(t,e){var o={},i={},n=!1;return Object.keys(t).forEach(function(o){var r=Object.getOwnPropertyDescriptor(t,o);e&&e(o,r)&&(i[o]=r,n=!0)}),n&&Object.defineProperties(o,i),o},o.utils.mapObject=function(t,e){var i={},n={},r=!1;return Object.keys(t).forEach(function(i){var s=Object.getOwnPropertyDescriptor(t,i),c=e&&e(i,s);"object"===o.utils.type(c)&&(n[c.name]=c.descr,r=!0)}),r&&Object.defineProperties(i,n),i},o.utils.isEmptyObject=function(t){if("object"===o.utils.type(t))for(var e in t)if(n.call(t,e))return!1;return!0},o.utils.isWindow=function(t){return null!==t&&t===t.window},o.utils.uid=function(){return t.Math.floor(268435456*(1+t.Math.random())).toString(36)},o.utils.Table=function(t,i){this._options=o.utils.merge({col:"xb-menu:not([disabled])",row:"xb-menuitem:not([disabled])",colLoop:!1,rowLoop:!1},i),this._node=t,this._item=e,this._originalEvent=e,this._onKeydown=this._onKeydown.bind(this),this._onMouseover=o.event.delegate(this._options.row,this._onMouseover.bind(this)),this._onMouseout=o.event.delegate(this._options.row,this._onMouseout.bind(this)),this._onMousemove=o.utils.throttle(o.event.delegate(this._options.row,this._onMouseAction.bind(this))),this._onClick=o.event.filterClick("left",o.event.delegate(this._options.row,this._onMouseAction.bind(this))),this._bind()},o.utils.Table.prototype={EVENT_BLUR:"xb-blur",EVENT_FOCUS:"xb-focus",destroy:function(){this._unbind(),this._node=e,this._originalEvent=e,this._item&&o.event.dispatch(this._item,this.EVENT_BLUR)},getItem:function(){return this._item},_bind:function(){this._node.addEventListener("keydown",this._onKeydown,!1),this._node.addEventListener("click",this._onClick,!1),this._node.addEventListener("mouseover",this._onMouseover,!1),this._node.addEventListener("mouseout",this._onMouseout,!1),this._node.addEventListener("mousemove",this._onMousemove,!1)},_unbind:function(){this._node.removeEventListener("keydown",this._onKeydown,!1),this._node.removeEventListener("click",this._onClick,!1),this._node.removeEventListener("mouseover",this._onMouseover,!1),this._node.removeEventListener("mouseout",this._onMouseout,!1),this._node.removeEventListener("mousemove",this._onMousemove,!1)},_col:function(t){if(t)for(var e=t;e=e.parentNode;){if(o.dom.matchesSelector(e,this._options.col))return e;if(e===this._node)break}},_colFirst:function(){return this._node.querySelector(this._options.col)||this._node},_colLast:function(){return Array.prototype.pop.call(Array.prototype.slice.call(this._node.querySelectorAll(this._options.col)))||this._node},_colMatchIterate:function(t,e){return o.dom.matchesSelector(e,this._options.col)?(t.col=e,!1):void 0},_colNext:function(t){var e={};return o.dom.eachAfter(t,this._colMatchIterate.bind(this,e),this._node,!1),e.col},_colPrev:function(t){var e={};return o.dom.eachBefore(t,this._colMatchIterate.bind(this,e),this._node,!1),e.col},_rowFirst:function(t){return t.querySelector(this._options.row)},_rowLast:function(t){return Array.prototype.pop.call(Array.prototype.slice.call(t.querySelectorAll(this._options.row)))},_rowMatchIterate:function(t,e){return o.dom.matchesSelector(e,this._options.row)?(t.row=e,!1):void 0},_rowNext:function(t){var e={};return o.dom.eachAfter(t,this._rowMatchIterate.bind(this,e),this._col(t),!1),e.row},_rowPrev:function(t){var e={};return o.dom.eachBefore(t,this._rowMatchIterate.bind(this,e),this._col(t),!1),e.row},_rowIndex:function(t){return o.dom.index(this._options.row,t,this._col(t))},_rowByIndex:function(t,e){return t.querySelectorAll(this._options.row)[e]},_focus:function(t){t!==this._item&&(this._item&&o.event.dispatch(this._item,this.EVENT_BLUR,{detail:{originalEvent:this._originalEvent}}),this._item=t,o.event.dispatch(this._item,this.EVENT_FOCUS,{detail:{originalEvent:this._originalEvent}}))},_onKeydown:function(t){if(!(t.altKey||t.metaKey||t.shiftKey))switch(this._originalEvent=t,t.keyCode){case 37:this._onArrowLeft();break;case 38:this._onArrowUp();break;case 39:this._onArrowRight();break;case 40:this._onArrowDown()}},_onMouseAction:function(t){this._item&&this._item===t.delegateElement||(this._originalEvent=t,this._focus(t.delegateElement))},_onMouseover:function(t){o.event.filterMouseEnter(t.delegateElement,t,this._onMouseAction.bind(this))},_onMouseout:function(t){o.event.filterMouseLeave(t.delegateElement,t,this._onMouseAction.bind(this))},_onArrowLeft:function(){if(this._item){var t=this._rowIndex(this._item),e=this._colPrev(this._col(this._item));e||(e=this._colLast(),this._options.colLoop||t--);var o=this._rowByIndex(e,t);o||(o=this._rowLast(e)),this._focus(o)}else this._focus(this._rowFirst(this._colFirst()))},_onArrowRight:function(){if(this._item){var t=this._rowIndex(this._item),e=this._colNext(this._col(this._item));e||(e=this._colFirst(),this._options.colLoop||t++);var o=this._rowByIndex(e,t);o||(o=this._rowFirst(e)),this._focus(o)}else this._focus(this._rowFirst(this._colFirst()))},_onArrowUp:function(){if(this._item){var t=this._rowPrev(this._item);if(!t){var e;e=this._options.rowLoop?this._col(this._item):this._colPrev(this._col(this._item))||this._colLast(),t=this._rowLast(e)}this._focus(t)}else this._focus(this._rowFirst(this._colFirst()))},_onArrowDown:function(){if(this._item){var t=this._rowNext(this._item);if(!t){var e;e=this._options.rowLoop?this._col(this._item):this._colNext(this._col(this._item))||this._colFirst(),t=this._rowFirst(e)}this._focus(t)}else this._focus(this._rowFirst(this._colFirst()))}},o.dom.index=function(e,o,n){return i.call((n||t.document).querySelectorAll(e),o)},o.dom.isParent=function(){var e=t.document.documentElement;return"compareDocumentPosition"in e?function(t,e){return 16==(16&t.compareDocumentPosition(e))}:"contains"in e?function(t,e){return t!==e&&t.contains(e)}:function(t,e){for(;e=e.parentNode;)if(e===t)return!0;return!1}}(),o.dom.matchesSelector=function(){var t=Element.prototype,e=t.matches||t.matchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector||t.oMatchesSelector||function(t){return-1!==i.call((this.parentNode||this.ownerDocument).querySelectorAll(t),this)};return function(t,o){return 1===t.nodeType?e.call(t,o):!1}}(),o.dom.eachInnerFollowing=function(t,e){for(var o,i,n,r=[t];o=r.pop();){if(i=e&&e(o,r),"undefined"!=typeof i&&!i)return!1;if("next"!==i&&1===o.nodeType&&o.hasChildNodes())for(n=o.childNodes.length;n--;)r.push(o.childNodes[n])}return!0},o.dom.eachInnerPrevious=function(t,e){for(var o,i,n,r,s=[t];o=s.pop();){if(i=e&&e(o,s),"undefined"!=typeof i&&!i)return!1;if("next"!==i&&1===o.nodeType&&o.hasChildNodes())for(r=o.childNodes.length,n=0;r>n;n++)s.push(o.childNodes[n])}return!0},o.dom.eachBefore=function(t,e,i,n){n="undefined"==typeof n?!0:Boolean(n);var r,s;do{if(i&&!o.dom.isParent(i,t))return;for(r=t;r=r.previousSibling;)if(s=n?o.dom.eachInnerPrevious(r,e):e&&e(r),"undefined"!=typeof s&&!s)return!1}while(t=t.parentNode)},o.dom.eachAfter=function(t,e,i,n){n="undefined"==typeof n?!0:Boolean(n);var r,s;do{if(i&&!o.dom.isParent(i,t))return;for(r=t;r=r.nextSibling;)if(s=n?o.dom.eachInnerFollowing(r,e):e&&e(r),"undefined"!=typeof s&&!s)return!1}while(t=t.parentNode)},o.event.delegate=function(t,e){return function(i){var n,r=i.target||i.srcElement;if(r.tagName){if(o.dom.matchesSelector(r,t))n=r;else if(o.dom.matchesSelector(r,t+" *"))for(var s=r.parentNode;s;){if(o.dom.matchesSelector(s,t)){n=s;break}s=s.parentNode}n&&(i.delegateElement=n,e.call(n,i))}}},o.event._clickWhich={1:"left",2:"center",3:"right"},o.event.filterClick=function(t,e){return t=Array.isArray(t)?t:[t],function(i){if("click"===i.type){var n=i.which;!n&&i.button&&(1&i.button?n=1:4&i.button?n=2:2&i.button&&(n=3)),n=o.event._clickWhich[n],-1!==t.indexOf(n)&&e.call(this,i)}}},o.event.filterMouseEnter=function(t,e,o){for(var i=e.relatedTarget||e.srcElement;i&&i!==t;)i=i.parentNode;return i!==t?o.call(t,e):void 0},o.event.filterMouseLeave=o.event.filterMouseEnter}(function(){return this||(1,eval)("this")}());